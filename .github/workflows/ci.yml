name: CI

on: [push, pull_request]

jobs:
  test-and-coverage:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Install dependencies
        run: npm ci

      - name: Run Jest tests with coverage
        run: npm test -- --coverage

      # Jest ì»¤ë²„ë¦¬ì§€ ë¦¬í¬íŠ¸ë¥¼ PRì— ì½”ë©˜íŠ¸ë¡œ ë‚¨ê¸°ëŠ” ì•¡ì…˜ ì¶”ê°€
      - name: Jest Coverage Report
        uses: ArtiomTr/jest-coverage-report-action@v2
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const pull_number = ${{ github.event.pull_request.number }}
            const updated_title = `[TEST FAIL] ${{ github.event.pull_request.title }}`
            await github.rest.pulls.createReview({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: pull_number,
              body: 'í…ŒìŠ¤íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.',
              event: 'REQUEST_CHANGES'
            })
      - run: echo '${{github.actor}}ë‹˜! ê³ ìƒí•˜ì…¨ìŠµë‹ˆë‹¤! ğŸ»'
